generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String    @id @default(uuid()) @db.Uuid
  fullName       String    @map("full_name") @db.VarChar(150)
  email          String    @unique @db.VarChar(150)
  phone          String?   @db.VarChar(20)
  address        String?
  profileImage   String?   @map("profile_image")
  passwordHash   String    @map("password_hash")
  role           Role
  birthDay       Int?      @map("birth_day")
  birthMonth     Int?      @map("birth_month")
  notificationConsent Boolean @default(true) @map("notification_consent")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @default(now()) @updatedAt @map("updated_at")
  bookings       Booking[] @relation("CustomerBookings")
  stylistProfile Stylist?

  @@map("users")
}

model Style {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique @db.VarChar(100)
  imageUrl  String?  @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")
  pricing   StylePricing[]
  bookings  Booking[]
  stylists  Stylist[]

  @@map("styles")
}

model Category {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique @db.VarChar(150)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  bookings  Booking[]
  pricing   StylePricing[]

  @@map("categories")
}

model Stylist {
  id         String    @id @default(uuid()) @db.Uuid
  userId     String    @unique @map("user_id") @db.Uuid
  skillLevel String?   @map("skill_level") @db.VarChar(50)
  surcharge  Decimal   @default(0.00) @db.Decimal(10, 2)
  styleSurcharges Json? @map("style_surcharges")
  workingHours Json?    @map("working_hours")
  isActive   Boolean   @default(true) @map("is_active")
  createdAt  DateTime  @default(now()) @map("created_at")
  bookings   Booking[]
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  styles     Style[]
  leaves     StylistLeave[]

  @@map("stylists")
}

model StylistLeave {
  id        String   @id @default(uuid()) @db.Uuid
  stylistId String   @map("stylist_id") @db.Uuid
  startDate DateTime @map("start_date") @db.Date
  endDate   DateTime @map("end_date") @db.Date
  reason    String?  @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  
  stylist   Stylist  @relation(fields: [stylistId], references: [id], onDelete: Cascade)

  @@map("stylist_leaves")
  @@index([stylistId])
  @@index([startDate, endDate])
}

model StylePricing {
  id              String   @id @default(uuid()) @db.Uuid
  styleId         String   @map("style_id") @db.Uuid
  categoryId      String   @map("category_id") @db.Uuid
  price           Decimal  @db.Decimal(10, 2)
  durationMinutes Int      @default(60) @map("duration_minutes")
  
  style           Style    @relation(fields: [styleId], references: [id], onDelete: Cascade)
  category        Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  promos          MonthlyPromo[]

  @@unique([styleId, categoryId])
  @@map("style_pricing")
}

model Availability {
  id           String   @id @default(uuid()) @db.Uuid
  date         DateTime @db.Date
  timeSlot     DateTime @map("time_slot") @db.Time(6)
  stylistCount Int      @map("stylist_count")
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([date, timeSlot])
  @@map("availability")
}

model Booking {
  id          String        @id @default(uuid()) @db.Uuid
  customerId  String?       @map("customer_id") @db.Uuid
  styleId     String?       @map("style_id") @db.Uuid
  categoryId  String?       @map("category_id") @db.Uuid
  stylistId   String?       @map("stylist_id") @db.Uuid
  promoId     String?       @map("promo_id") @db.Uuid
  bookingDate DateTime      @map("booking_date") @db.Date
  bookingTime DateTime      @map("booking_time") @db.Time(6)
  status      BookingStatus @default(booked)
  notes       String?
  createdAt   DateTime      @default(now()) @map("created_at")
  customer    User?         @relation("CustomerBookings", fields: [customerId], references: [id])
  style       Style?        @relation(fields: [styleId], references: [id])
  category    Category?     @relation(fields: [categoryId], references: [id])
  stylist     Stylist?      @relation(fields: [stylistId], references: [id])
  promo       MonthlyPromo? @relation(fields: [promoId], references: [id])
  payments    Payment[]

  @@map("bookings")
}

model Payment {
  id              String   @id @default(uuid()) @db.Uuid
  bookingId       String   @map("booking_id") @db.Uuid
  stripePaymentId String?  @map("stripe_payment_id") @db.VarChar(255)
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("USD") @db.VarChar(10)
  status          String?  @db.VarChar(30)
  createdAt       DateTime @default(now()) @map("created_at")
  booking         Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model ChatbotKnowledge {
  id        String   @id @default(uuid()) @db.Uuid
  title     String?  @db.VarChar(150)
  content   String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("chatbot_knowledge")
}

model SalonSettings {
  id                   String   @id @default(uuid()) @db.Uuid
  salonName            String   @default("Victoria Braids & Weaves") @map("salon_name") @db.VarChar(150)
  address              String?  @db.Text
  phone                String?  @db.VarChar(50)
  email                String?  @db.VarChar(150)
  businessHours        Json?    @map("business_hours")
  logoUrl              String?  @map("logo_url")
  depositAmount        Decimal  @default(50.00) @map("deposit_amount") @db.Decimal(10, 2)
  timezone             String   @default("UTC") @db.VarChar(50)
  notificationsEnabled Boolean  @default(true) @map("notifications_enabled")
  requireApproval      Boolean  @default(true) @map("require_approval")
  customerModuleEnabled Boolean @default(true) @map("customer_module_enabled")
  showFaqSection       Boolean  @default(true) @map("show_faq_section")
  courtesyNotice       String?  @db.Text @map("courtesy_notice")
  updatedAt            DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("salon_settings")
}

model Faq {
  id        String   @id @default(uuid()) @db.Uuid
  question  String   @db.Text
  answer    String   @db.Text
  order     Int      @default(0)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("faqs")
}

model BookingPolicy {
  id        String   @id @default(uuid()) @db.Uuid
  content   String   @db.Text
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("booking_policies")
}

enum Role {
  admin
  stylist
  customer
}

enum BookingStatus {
  booked
  in_progress
  completed
  cancelled
  checked_in
}

model Notification {
  id          String   @id @default(uuid()) @db.Uuid
  type        NotificationType
  channel     NotificationChannel
  recipient   String   @db.VarChar(150)
  subject     String?  @db.VarChar(255)
  content     String   @db.Text
  status      NotificationStatus @default(PENDING)
  retryCount  Int      @default(0) @map("retry_count")
  metadata    Json?
  sentAt      DateTime? @map("sent_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("notifications")
}

model NotificationTemplate {
  id          String           @id @default(uuid()) @db.Uuid
  name        String           @unique @db.VarChar(100)
  type        NotificationType
  channel     NotificationChannel
  subject     String?          @db.VarChar(255)
  content     String           @db.Text
  variables   Json?
  isActive    Boolean          @default(true) @map("is_active")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @default(now()) @updatedAt @map("updated_at")

  @@map("notification_templates")
}

model GalleryItem {
  id        String   @id @default(uuid()) @db.Uuid
  title     String   @db.VarChar(150)
  category  String   @db.VarChar(50)
  imageUrl  String   @map("image_url")
  order     Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("gallery_items")
}

enum NotificationType {
  BN
  GN
  BTDN
  PN
  EN
  AN
}

enum NotificationChannel {
  EMAIL
  SMS
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
  WAITING_APPROVAL
  REJECTED
}

model MonthlyPromo {
  id             String   @id @default(uuid()) @db.Uuid
  
  title          String?  @db.VarChar(150)
  promoMonth     String   @map("promo_month")
  promoYear      Int      @map("promo_year")
  offerEnds      DateTime @map("offer_ends")

  stylePricingId String       @map("style_pricing_id") @db.Uuid
  stylePricing   StylePricing @relation(fields: [stylePricingId], references: [id])
  bookings       Booking[]

  promoPrice     Decimal  @map("promo_price") @db.Decimal(10, 2)
  discountPercentage Int?     @map("discount_percentage")
  promoDuration  Int?     @map("promo_duration")
  
  terms          String[]
  description    String?

  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("monthly_promos")
}
